<apex:page standardcontroller="ICF_Survey__c" extensions="ICF_SurveyAndQuestionController" cache="false" sidebar="false" showheader="false" >

  <apex:stylesheet value="{!$Page.ICF_labs_survey_css}" />

  <apex:includeScript value="{!URLFOR($Resource.ICF_SurveyForce, 'jquery.js')}"/>
  <script type="text/javascript" src="{!URLFOR($Resource.ICF_SurveyForce, 'survey_jui.js')}" ></script>


  <style>
    table tr{
      width:200px;
      border:1px;
    } 

    form[id*="navBar"]{
      position: relative;
      background: #fff;
      z-index: 10;
    }

    #navBarBg{
      width: 100%;
      height: 30px;
      z-index: 9;
      position: fixed;
      top:0;
      left: 0;
      background: #fff;
      display: none;
      -moz-box-shadow:0 0 30px #000;
      -webkit-box-shadow:0 0 30px #000;
    }

    #surveyMenu h4{
      display: block;
      margin-top: 10px;
    }
    .matrixChoice {
      text-align: center;
    }

    .matrixHeader {
      padding-left: 15px;
    }

  </style>
  <script src="/soap/ajax/18.0/connection.js" type="text/javascript"></script>
  <script src="/soap/ajax/18.0/apex.js" type="text/javascript"></script>
  <script>sforce.connection.sessionId = '{!$Api.Session_ID}'; </script>

  <script type="text/javascript">
    // HOTFIX: We can't upgrade to jQuery UI 1.8.6 (yet)
    // This hotfix makes older versions of jQuery UI drag-and-drop work in IE9
    (function($){var a=$.ui.mouse.prototype._mouseMove;$.ui.mouse.prototype._mouseMove=function(b){if($.browser.msie&&document.documentMode>=9){b.button=1};a.apply(this,[b]);}}(jQuery));

    function clearFields() {
        $("textarea[id*='qQuestion']").val("");
        $("textarea[id*='qChoices']").val("");
        $("textarea[id*='qSubQuestions']").val("");
    }

    function confirmDelete(deleteId) {
        var r = confirm("Are you sure you want to delete this question?");
        if (r) {
            return true;
        } else {
            return false;
        }
    }

    $(document).ready(function() {

        // Displays overlays
        $("a[rel]").overlay({
            oneInstance: 'false',
            mask: '#000',
            zIndex: '1000',
            onLoad: function() {
                if ($.browser.msie && $.browser.version == 7.0) {
                    $('#exposeMask').hide();
                }
            }
        });



        // setup h2#editMenu to work as tabs for each div directly under div#editSections
        $("h2#editMenu").tabs("div#editSections > div", {
            tabs: 'span'
        });

        $(window).scroll(function() {
            if ($(this).scrollTop() > 148) {
                $('#navBarBg').fadeIn(1000);
                $('form[id*="navBar"]').css('position', "fixed");
                $('form[id*="navBar"]').css('top', "4px");
                $('form[id*="navBar"]').css('width', $('body').width() - 40 + "px");
            } else if ($(this).scrollTop() < 148) {
                $('#navBarBg').fadeOut(100);
                $('form[id*="navBar"]').css('position', "relative");
                $('form[id*="navBar"]').css('top', "0px");
            }
        });

        $("#justQuestionList").sortable({
            axis: 'y',
            opacity: .6,
            tolerance: 'pointer',
            revert: true,
            update: function(event, ui) {
                var elemParent = $('#justQuestionList');
                var childrenList = elemParent.children();
                var childIds = new Array();
                var cIds = "";
                if (childrenList != null) {
                    for (var i = 0; i < childrenList.length; i++) {
                        cIds = cIds + childrenList[i].id + ",";

                    }
                    jQuery("input[id*='newOrderList']").val(cIds);
                    jQuery("a[id*='saveOrder']").effect("pulsate", {
                        times: 2
                    }, 1000);
                }
            }
        });

        $("#surveyDeleteLink").click(function() {
            if ($("#surveyDelete").css("display") == "none") {
                $("#surveyDelete").fadeIn();
            } else {
                $("#surveyDelete").fadeOut();
            }
        });

        $("#surveyCancelLink").click(function() {
            $("#surveyDelete").fadeOut();
        });

    });

    function resetSelect() {
        $("select[id*='questionSelect']").val(0);
    };

    function verifyMatrixSize() {

    }

  </script>
  <div id="labs_container">   
    <div id="fade" class="black_overlay"></div>

    <apex:form id="frmQuestions" >
      <apex:pageMessages />

      <apex:pageBlock >
        <div id="navBarBg"></div>

        <apex:outputPanel id="navBar">
          <apex:commandLink styleclass="btn left" rel="#addQuestion" action="{!makeNewQuestionLink}" value="{!$Label.LABS_SF_AddQuestion}" onComplete="resetSelect();" reRender="opQuestionContainer"/>
          <apex:commandLink id="saveOrder2" action="{!updateOrderList}" value="{!$Label.LABS_SF_SaveOrder}" styleclass="btn left"/>        
          <apex:inputHidden id="newOrderList" value="{!newOrderW}" />    
          <span id="alertOrderUpdated">The survey has been updated.</span>
        </apex:outputPanel>   
      </apex:pageBlock>

        <div id="addQuestion" class="overlay">
          <apex:actionRegion >
              <apex:outputPanel id="selectQuestionType" >
                <span class="prompt">{!$Label.LABS_SF_SelectQuestionType}
                  <div id="topPickList">
                    <apex:actionFunction name="setupQuestionFieldsJS" action="{!setupQuestionFields}" oncomplete="clearFields()" reRender="opQuestionContainer,addQuestion,singleSelect,multiSelect,freeText,rowQuestion,email,phone,picklist,matrixSingle,matrixMulti"/>
                    <apex:selectList size="1" value="{!questionType}" id="questionSelect" onchange="setupQuestionFieldsJS(); return false;">
                      <apex:selectOptions value="{!questionTypeOptions}"/> 
                    </apex:selectList>
                  </div>
                </span>

              </apex:outputPanel>
          </apex:actionRegion>

          <apex:outputPanel id="opQuestionContainer" >

            <!-- Single Select Question  -->
            <apex:outputPanel id="singleSelect" >
              <apex:pageBlock rendered="{!showSingleSelect}">
                <apex:outputPanel id="singleSelectForm">
                  <span class="prompt">{!$Label.LABS_SF_Question}</span>
                  <apex:inputTextArea cols="30" rows="3" id="qQuestion" value="{!qQuestion}" required="true" title="The question you would like asked"/>
                  <!--TCF_Feb202017 START: Added style property to span tag-->
                  <span class="prompt" style="float: none;">{!$Label.LABS_SF_RequiredQuestion} <apex:inputCheckbox value="{!qRequired}" title="Is an answer for the question required?(default is true)" selected="{!requiredBool}"/></span>
                  
                  <!--TCF_Feb202017 START: Added Send To EKOMI as drop-down-->
                  <apex:outputPanel rendered="{!surveySendToEKOMI}">
                      <div class="prompt" style="padding:0px;">{!$Label.LABS_SF_SendToEKOMIAs} &nbsp;
                          <apex:selectList size="1" value="{!qSendToEKOMIAs}" id="sendToEKOMIAsSelect"><apex:selectOptions value="{!sendToEKOMIAsOptions}"/></apex:selectList>
                      </div>
                  </apex:outputPanel> 
                  <!--TCF_Feb202017 END: Added Send To EKOMI as drop-down-->  
                    
                  <span class="prompt">{!$Label.LABS_SF_PleaseEnterTheList}</span>
                  <apex:inputTextArea cols="40" rows="12" id="qChoices" value="{!qChoices}" required="true" title="Answers to question..."/>

                  <div style="clear:both;" />
                  <a href="" class="right btn" onClick="$('.close').click(); return false;">{!$Label.LABS_SF_Cancel}</a>
                  <apex:commandButton action="{!controllerSavQuestion}" value="{!$Label.LABS_SF_Save}"/>

                </apex:outputPanel>
              </apex:pageBlock>
            </apex:outputPanel>

            <!--  Multi Select Question -->
            <apex:outputPanel id="multiSelect">
              <apex:pageBlock rendered="{!showMultiSelect}">
                <apex:outputPanel id="multiSelectForm">
                  <span class="prompt">{!$Label.LABS_SF_Question}</span>
                  <apex:inputTextArea cols="30" rows="3" id="qQuestion" value="{!qQuestion}" required="true" title="The question you would like asked"/>
                  <!--TCF_Feb202017 START: Added style property to span tag-->
                  <span class="prompt" style="float: none;">{!$Label.LABS_SF_RequiredQuestion} <apex:inputCheckbox value="{!qRequired}" title="Is an answer for the question required?(default is true)" selected="{!requiredBool}"/></span>
                  
                  <!--TCF_Feb202017 START: Added Send To EKOMI as drop-down-->
                  <apex:outputPanel rendered="{!surveySendToEKOMI}">
                      <div class="prompt" style="padding:0px;">{!$Label.LABS_SF_SendToEKOMIAs} &nbsp;
                          <apex:selectList size="1" value="{!qSendToEKOMIAs}" id="sendToEKOMIAsSelect"><apex:selectOptions value="{!sendToEKOMIAsOptions}"/></apex:selectList>
                      </div>
                  </apex:outputPanel> 
                  <!--TCF_Feb202017 END: Added Send To EKOMI as drop-down-->  
                    
                  <span class="prompt">{!$Label.LABS_SF_PleaseEnterTheList}</span>
                  <apex:inputTextArea cols="40" rows="12" id="qChoices" value="{!qChoices}" required="true" title="Answers to question..."/>

                  <div style="clear:both;" />
                  <a href="" class="right btn" onClick="$('.close').click(); return false;">{!$Label.LABS_SF_Cancel}</a>
                  <apex:commandButton action="{!controllerSavQuestion}" value="{!$Label.LABS_SF_Save}"/>
                </apex:outputPanel>
              </apex:pageBlock>
            </apex:outputPanel>

            <!-- Free Text Question -->
            <apex:outputPanel id="freeText">
              <apex:pageBlock rendered="{!showFreeText}">
                <apex:outputPanel id="freeTextForm">
                  <span class="prompt">{!$Label.LABS_SF_Question}</span>
                  <apex:inputTextArea cols="30" rows="3" id="qQuestion" value="{!qQuestion}" required="true" title="The question you would like asked"/>

                  <div class="prompt" style="float: none;">
                    {!$Label.LABS_SF_RequiredQuestion} <apex:inputCheckbox value="{!qRequired}" title="Is an answer for the question required?(default is true)" selected="{!requiredBool}"/>
                  </div>
                  
                  <!--TCF_Feb202017 START: Added Send To EKOMI as drop-down-->
                  <apex:outputPanel rendered="{!surveySendToEKOMI}">
                      <div class="prompt" style="padding:0px;">{!$Label.LABS_SF_SendToEKOMIAs} &nbsp;
                          <apex:selectList size="1" value="{!qSendToEKOMIAs}" id="sendToEKOMIAsSelect"><apex:selectOptions value="{!sendToEKOMIAsOptions}"/></apex:selectList>
                      </div>
                  </apex:outputPanel> 
                  <!--TCF_Feb202017 END: Added Send To EKOMI as drop-down-->  
                    
                  <div style="clear:both;" />
                  <a href="" class="right btn" onClick="$('.close').click(); return false;">{!$Label.LABS_SF_Cancel}</a>
                  <apex:commandButton action="{!controllerSavQuestion}" value="{!$Label.LABS_SF_Save}"/>
                </apex:outputPanel>
              </apex:pageBlock>
            </apex:outputPanel>

            <!-- Row Question (single select horizontal)  -->
            <apex:outputPanel id="rowQuestion">
              <apex:pageBlock rendered="{!showRowQuestion}">
                <apex:outputPanel id="frowQuestionForm">
                  <span class="prompt">{!$Label.LABS_SF_Question}</span>
                  <apex:inputTextArea cols="30" rows="3" id="qQuestion" value="{!qQuestion}" required="true" title="The question you would like asked"/>
                  
                  <div class="prompt" style="float: none;">{!$Label.LABS_SF_RequiredQuestion} <apex:inputCheckbox value="{!qRequired}" title="Is an answer for the question required?(default is true)" selected="{!requiredBool}"/></div>
                  
                  <div class="prompt" style="padding:0px;float: none;">Display with Stars ? <apex:inputCheckbox value="{!qSmileyQuestion}" title="Display the matrix with smileys" /> </div>
                  
                  <!--TCF_Feb172017 START: Added Send To EKOMI as drop-down-->
                  <apex:outputPanel rendered="{!surveySendToEKOMI}">
                      <div class="prompt" style="padding:0px;">{!$Label.LABS_SF_SendToEKOMIAs} &nbsp;
                          <apex:selectList size="1" value="{!qSendToEKOMIAs}" id="sendToEKOMIAsSelect"><apex:selectOptions value="{!sendToEKOMIAsOptions}"/></apex:selectList>
                      </div>
                  </apex:outputPanel> 
                  <!--TCF_Feb172017 END: Added Send To EKOMI as drop-down-->  
                    
                  <span class="prompt">{!$Label.LABS_SF_PleaseEnterTheList}</span>
                  <apex:inputTextArea cols="40" rows="12" id="qChoices" value="{!qChoices}" required="true" title="Answers to question..."/>

                  <div style="clear:both;" />
                  <a href="" class="right btn" onClick="$('.close').click(); return false;">{!$Label.LABS_SF_Cancel}</a>
                  <apex:commandButton action="{!controllerSavQuestion}" value="{!$Label.LABS_SF_Save}"/>
                </apex:outputPanel>
              </apex:pageBlock>
            </apex:outputPanel>

            <!--BCH 03/02/2015 add 2 new question types -->
            <!-- Email Question -->
            <apex:outputPanel id="email">
              <apex:pageBlock rendered="{!showEmail}">
                <apex:outputPanel id="freeEmailForm">
                  <span class="prompt">{!$Label.LABS_SF_Question}</span>
                  <apex:inputTextArea cols="60" rows="1" id="qQuestion" value="{!qQuestion}" required="true" title="The question you would like asked"/>

                  <div class="prompt" style="float: none;">
                    {!$Label.LABS_SF_RequiredQuestion} <apex:inputCheckbox value="{!qRequired}" title="Is an answer for the question required?(default is true)" selected="{!requiredBool}"/>
                  </div>
                  
                  <!--TCF_Feb202017 START: Added Send To EKOMI as drop-down-->
                  <apex:outputPanel rendered="{!surveySendToEKOMI}">
                      <div class="prompt" style="padding:0px;">{!$Label.LABS_SF_SendToEKOMIAs} &nbsp;
                          <apex:selectList size="1" value="{!qSendToEKOMIAs}" id="sendToEKOMIAsSelect"><apex:selectOptions value="{!sendToEKOMIAsOptions}"/></apex:selectList>
                      </div>
                  </apex:outputPanel> 
                  <!--TCF_Feb202017 END: Added Send To EKOMI as drop-down-->  
                    
                  <div style="clear:both;" />
                  <a href="" class="right btn" onClick="$('.close').click(); return false;">{!$Label.LABS_SF_Cancel}</a>
                  <apex:commandButton action="{!controllerSavQuestion}" value="{!$Label.LABS_SF_Save}"/>
                </apex:outputPanel>
              </apex:pageBlock>
            </apex:outputPanel>

            <!--DLX 10/08/2015 add 2 new question types -->
            <!-- Phone Question -->
            <apex:outputPanel id="phone">
              <apex:pageBlock rendered="{!showPhone}">
                <apex:outputPanel id="freePhoneForm">
                  <span class="prompt">{!$Label.LABS_SF_Question}</span>
                  <apex:inputTextArea cols="60" rows="1" id="qQuestion" value="{!qQuestion}" required="true" title="The question you would like asked"/>

                  <div class="prompt" style="float: none;">
                    {!$Label.LABS_SF_RequiredQuestion} <apex:inputCheckbox value="{!qRequired}" title="Is an answer for the question required?(default is true)" selected="{!requiredBool}"/>
                  </div>
                  
                  <!--TCF_Feb202017 START: Added Send To EKOMI as drop-down-->
                  <apex:outputPanel rendered="{!surveySendToEKOMI}">
                      <div class="prompt" style="padding:0px;">{!$Label.LABS_SF_SendToEKOMIAs} &nbsp;
                          <apex:selectList size="1" value="{!qSendToEKOMIAs}" id="sendToEKOMIAsSelect"><apex:selectOptions value="{!sendToEKOMIAsOptions}"/></apex:selectList>
                      </div>
                  </apex:outputPanel> 
                  <!--TCF_Feb202017 END: Added Send To EKOMI as drop-down-->    
                    
                  <div style="clear:both;" />
                  <a href="" class="right btn" onClick="$('.close').click(); return false;">{!$Label.LABS_SF_Cancel}</a>
                  <apex:commandButton action="{!controllerSavQuestion}" value="{!$Label.LABS_SF_Save}"/>
                </apex:outputPanel>
              </apex:pageBlock>
            </apex:outputPanel>


            <!--DLX 23/10/2015 add new question types : matrix -->
            <!-- Matrix single Question -->
            <apex:outputPanel id="matrixSingle">
              <apex:pageBlock rendered="{!showMatrixSingleSelect}">
                <apex:outputPanel id="singleMatrixForm">
                  <span class="prompt">{!$Label.LABS_SF_Question}</span>
                  <apex:inputTextArea cols="60" rows="1" id="qQuestion" value="{!qQuestion}" required="true" title="The question you would like asked"/>

                  <div class="prompt" style="float: none;">
                    {!$Label.LABS_SF_RequiredQuestion} <apex:inputCheckbox value="{!qRequired}" title="Is an answer for the question required?(default is true)" selected="{!requiredBool}"/>
                  </div>           

                  <div class="prompt" style="padding:0px;float: none;">Display with smileys ? <apex:inputCheckbox value="{!qSmileyQuestion}" title="Display the matrix with smileys" /> </div>
                  
                  <!--TCF_Feb172017 START: Added Send To EKOMI as drop-down-->
                  <apex:outputPanel rendered="{!surveySendToEKOMI}">
                      <div class="prompt" style="padding:0px;">{!$Label.LABS_SF_SendToEKOMIAs} &nbsp;
                          <apex:selectList size="1" value="{!qSendToEKOMIAs}" id="sendToEKOMIAsSelect"><apex:selectOptions value="{!sendToEKOMIAsOptions}"/></apex:selectList>
                      </div>
                  </apex:outputPanel> 
                  <!--TCF_Feb172017 END: Added Send To EKOMI as drop-down-->  

                  <span class="prompt">{!$Label.LABS_SF_PleaseEnterTheSubQuestion}</span>
                  <apex:inputTextArea cols="40" rows="5" id="qSubQuestions" value="{!qSubQuestions}" required="true" title="Sub questions"/>

                  <span class="prompt">{!$Label.LABS_SF_PleaseEnterTheList}</span>
                  <apex:inputTextArea cols="40" rows="12" id="qChoices" value="{!qChoices}" required="true" title="Answers to question..."/>

                  <div style="clear:both;" />
                  <a href="" class="right btn" onClick="$('.close').click(); return false;">{!$Label.LABS_SF_Cancel}</a>
                  <apex:commandButton action="{!controllerSavQuestion}" value="{!$Label.LABS_SF_Save}"/>
                </apex:outputPanel>
              </apex:pageBlock>
            </apex:outputPanel>

            <!-- Matrix Multi Question -->
            <apex:outputPanel id="matrixMulti">
              <apex:pageBlock rendered="{!showMatrixMultiSelect}">
                <apex:outputPanel id="multiMatrixForm">
                  <span class="prompt">{!$Label.LABS_SF_Question}</span>
                  <apex:inputTextArea cols="60" rows="1" id="qQuestion" value="{!qQuestion}" required="true" title="The question you would like asked"/>

                  <div class="prompt" style="float: none;">
                    {!$Label.LABS_SF_RequiredQuestion} <apex:inputCheckbox value="{!qRequired}" title="Is an answer for the question required?(default is true)" selected="{!requiredBool}"/>
                  </div>                  
                  
                  <!--TCF_Feb202017 START: Added Send To EKOMI as drop-down-->
                  <apex:outputPanel rendered="{!surveySendToEKOMI}">
                      <div class="prompt" style="padding:0px;">{!$Label.LABS_SF_SendToEKOMIAs} &nbsp;
                          <apex:selectList size="1" value="{!qSendToEKOMIAs}" id="sendToEKOMIAsSelect"><apex:selectOptions value="{!sendToEKOMIAsOptions}"/></apex:selectList>
                      </div>
                  </apex:outputPanel> 
                  <!--TCF_Feb202017 END: Added Send To EKOMI as drop-down-->    
                    
                  <span class="prompt">{!$Label.LABS_SF_PleaseEnterTheSubQuestion}</span>
                  <apex:inputTextArea cols="40" rows="5" id="qSubQuestions" value="{!qSubQuestions}" required="true" title="Sub questions"/>

                  <span class="prompt">{!$Label.LABS_SF_PleaseEnterTheList}</span>
                  <apex:inputTextArea cols="40" rows="12" id="qChoices" value="{!qChoices}" required="true" title="Answers to question..."/>

                  <div style="clear:both;" />
                  <a href="" class="right btn" onClick="$('.close').click(); return false;">{!$Label.LABS_SF_Cancel}</a>
                  <apex:commandButton action="{!controllerSavQuestion}" value="{!$Label.LABS_SF_Save}"/>
                </apex:outputPanel>
              </apex:pageBlock>
            </apex:outputPanel>



            <!-- Picklist Question -->
            <apex:outputPanel id="picklist">
              <apex:pageBlock rendered="{!showPicklist}">
                <apex:outputPanel id="picklistForm">
                  <span class="prompt">{!$Label.LABS_SF_Question}</span>
                  <apex:inputTextArea cols="30" rows="3" id="qQuestion" value="{!qQuestion}" required="true" title="The question you would like asked"/>
                  <!--TCF_Feb202017 START: Added style property to span tag-->
                  <span class="prompt" style="float: none;">{!$Label.LABS_SF_RequiredQuestion} <apex:inputCheckbox value="{!qRequired}" title="Is an answer for the question required?(default is true)" selected="{!requiredBool}"/></span>
                  
                  <!--TCF_Feb202017 START: Added Send To EKOMI as drop-down-->
                  <apex:outputPanel rendered="{!surveySendToEKOMI}">
                      <div class="prompt" style="padding:0px;">{!$Label.LABS_SF_SendToEKOMIAs} &nbsp;
                          <apex:selectList size="1" value="{!qSendToEKOMIAs}" id="sendToEKOMIAsSelect"><apex:selectOptions value="{!sendToEKOMIAsOptions}"/></apex:selectList>
                      </div>
                  </apex:outputPanel> 
                  <!--TCF_Feb202017 END: Added Send To EKOMI as drop-down-->    
                    
                  <span class="prompt">{!$Label.LABS_SF_PleaseEnterTheList}</span>
                  <apex:inputTextArea cols="40" rows="12" id="qChoices" value="{!qChoices}" required="true" title="Answers to question..."/>

                  <div style="clear:both;" />
                  <a href="" class="right btn" onClick="$('.close').click(); return false;">{!$Label.LABS_SF_Cancel}</a>
                  <apex:commandButton action="{!controllerSavQuestion}" value="{!$Label.LABS_SF_Save}"/>
                </apex:outputPanel>
              </apex:pageBlock>
            </apex:outputPanel>
          </apex:outputPanel>
        </div> <!-- End addQuestion -->

      <apex:pageBlock >
        <div id="questionList">

          <!-- Single Select Preview --> 
          <apex:outputPanel id="singleSelectPreview">
            <apex:pageBlock rendered="{!showSingleSelectPreview}">
              <div class="question">
                <div class="question_menu">
                  Single Select Preview
                </div>

                <table>
                  <h1>{!qQuestion}</h1>
                  <apex:outputPanel id="singleSelectPreviewForm">
                    <tr>
                      <td>
                        <apex:selectRadio layout="pageDirection" >
                          <apex:selectOptions value="{!singleOptions}"/>
                        </apex:selectRadio>
                      </td>
                    </tr>
                  </apex:outputPanel>
                </table>
              </div>
            </apex:pageBlock>
          </apex:outputPanel>

          <!-- Multi Select Preview -->
          <apex:outputPanel id="multiSelectPreview">
            <apex:pageBlock rendered="{!showMultiSelectPreview}">
              <div class="question">

                <div class="question_menu">
                  Multi Select Preview
                </div>

                <table>
                  <h1>{!qQuestion}</h1>
                  <apex:outputPanel id="multiSelectPreviewForm">
                    <tr>
                      <td>
                        <apex:selectCheckboxes layout="pageDirection" >
                          <apex:selectOptions value="{!multiOptions}"/>
                        </apex:selectCheckboxes>
                      </td>
                    </tr>
                  </apex:outputPanel>
                </table>
              </div>
            </apex:pageBlock>
          </apex:outputPanel>

          <!-- Free Text Preview -->
          <apex:outputPanel id="freeTextPreview">
            <apex:pageBlock rendered="{!showFreeTextPreview}">
              <div class="question">

                <div class="question_menu">
                  Free Text Preview
                </div>

                <table>
                  <h1>{!qQuestion}</h1>
                  <apex:outputPanel id="freeTextPreviewForm">
                    <tr>
                      <td>
                        <apex:inputTextArea cols="50" rows="10"/>
                      </td>
                    </tr>
                  </apex:outputPanel>
                </table>
              </div>
            </apex:pageBlock>
          </apex:outputPanel>

          <!-- Row Question Preview --> 
          <apex:outputPanel id="rowQuestionPreview">
            <apex:pageBlock rendered="{!showRowQuestionPreview}">
              <div class="question">

                <div class="question_menu">
                  Row Question Preview
                </div>

                <table>
                  <h1>{!qQuestion}</h1>
                  <apex:outputPanel id="rowQuestionForm">
                    <tr>
                      <td>
                        <apex:selectRadio >
                          <apex:selectOptions value="{!rowOptions}"/>
                        </apex:selectRadio>
                      </td>
                    </tr>
                  </apex:outputPanel>
                </table>
              </div>
            </apex:pageBlock>
          </apex:outputPanel>

          <!-- BCH 03/02 Add new types -->
          <!-- Email Preview -->
          <apex:outputPanel id="emailPreview">
            <apex:pageBlock rendered="{!showEmailPreview}">
              <div class="question">

                <div class="question_menu">
                  Email Preview
                </div>

                <table>
                  <h1>{!qQuestion}</h1>
                  <apex:outputPanel id="emailPreviewForm">
                    <tr>
                      <td>
                        <apex:inputText size="80"/>
                      </td>
                    </tr>
                  </apex:outputPanel>
                </table>
              </div>
            </apex:pageBlock>
          </apex:outputPanel>

          <!-- DLX 10/08/15 Add new types -->
          <!-- Phone Preview -->
          <apex:outputPanel id="phonePreview">
            <apex:pageBlock rendered="{!showPhonePreview}">
              <div class="question">

                <div class="question_menu">
                  Phone Preview
                </div>

                <table>
                  <h1>{!qQuestion}</h1>
                  <apex:outputPanel id="phonePreviewForm">
                    <tr>
                      <td>
                        <apex:inputText size="80"/>
                      </td>
                    </tr>
                  </apex:outputPanel>
                </table>
              </div>
            </apex:pageBlock>
          </apex:outputPanel>

           <!-- DLX Matrix Single Preview -->
          <apex:outputPanel id="matrixSinglePreview">
            <apex:pageBlock rendered="{!showMatrixSingleSelectPreview}">
              <div class="question">

                <div class="question_menu">
                  Matrix single Preview
                </div>

                <table>
                  <h1>{!qQuestion}</h1>
                  <apex:outputPanel id="matrixSingleForm">
                    <tr>
                      <td>
                        <apex:inputText size="80"/>
                      </td>
                    </tr>
                  </apex:outputPanel>
                </table>
              </div>
            </apex:pageBlock>
          </apex:outputPanel>

           <!-- DLX Matrix Multi Preview -->
          <apex:outputPanel id="matrixMultiPreview">
            <apex:pageBlock rendered="{!showMatrixMultiSelectPreview}">
              <div class="question">

                <div class="question_menu">
                  Matrix Multi Preview
                </div>

                <table>
                  <h1>{!qQuestion}</h1>
                  <apex:outputPanel id="matrixMultiForm">
                    <tr>
                      <td>
                        <apex:inputText size="80"/>
                      </td>
                    </tr>
                  </apex:outputPanel>
                </table>
              </div>
            </apex:pageBlock>
          </apex:outputPanel>

          <!-- Picklist Select Preview --> 
          <apex:outputPanel id="picklistPreview">
            <apex:pageBlock rendered="{!showPicklistPreview}">
              <div class="question">
                <div class="question_menu">
                  Picklist Preview
                </div>

                <table>
                  <h1>{!qQuestion}</h1>
                  <apex:outputPanel id="picklistPreviewForm">
                    <tr>
                      <td>
                        <apex:selectList size="1">
                          <apex:selectOptions value="{!picklistOptions}"/>
                        </apex:selectList>
                      </td>
                    </tr>
                  </apex:outputPanel>
                </table>
              </div>
            </apex:pageBlock>
          </apex:outputPanel>  

          <apex:outputPanel id="qListPanel">
            <div id="justQuestionList">
              <apex:repeat value="{!aQuestion}" var="q" id="qRepeat"> 
                <div id ="{!q.id}" class="question" title="Drag and Drop to Reorder">
                  <div class="question_menu">
                    <div class="questionNum">
                      {!q.orderNumber}
                    </div>
                    <apex:image value="{!URLFOR($Resource.ICF_SurveyForce, 'survey_upDown.png')}" styleClass="right"/>
                    <apex:commandLink styleclass="btn" action="{!editQuestion}" value="Edit" rel="#addQuestion" reRender="addQuestion,rowQuestion, rowQuestionPreview,singleSelect,singleSelectPreview,multiSelect,multiSelectPreview,freeText,freeTextPreview,email,emailPreview,phone, phonePreview,picklist,picklistPreview,selectQuestionType,matrixSingle,matrixMulti,matrixSinglePreview,matrixMultiPreview">
                      <apex:param name="q" value="{!q.id}" assignTo="{!questionReference}"/>
                    </apex:commandLink>
                    <apex:commandLink styleclass="btn" action="{!deleteRefresh}" onclick="return confirmDelete('{!q.id}')" ><font size="1"> Delete</font>
                      <apex:param name="q" value="{!q.id}" assignTo="{!questionReference}"/>            
                    </apex:commandLink>
                  </div>
                  <div class="questionContainer">
                    <h1>
                      {!q.Name}
                      <apex:outputPanel rendered="{!q.required}" styleClass="requiredText">
                        ({!$Label.LABS_SF_Required})
                      </apex:outputPanel>
                    </h1>
                    <div>
                      <apex:inputText size="80" rendered="{!q.renderEmail}"/>  
                      <apex:inputText size="80" rendered="{!q.renderPhone}"/>  
                      <div style="display:{!IF(q.renderPicklist == 'true', 'block', 'none')};">
                        <select>
                          <apex:repeat value="{!q.picklistStringOptions}" var="picklistValue" id="qOptionRepeat">
                            <option value="{!picklistValue}">{!picklistValue}</option>
                          </apex:repeat>
                        </select> 
                      </div>
                      <apex:selectRadio layout="pageDirection" rendered="{!q.renderSelectRadio}">
                        <apex:selectOptions value="{!q.singleOptions}"/>
                      </apex:selectRadio>
                      <apex:selectCheckboxes layout="pageDirection" rendered="{!q.renderSelectCheckboxes}">
                        <apex:selectOptions value="{!q.multiOptions}"/>
                      </apex:selectCheckboxes>
                      <apex:inputTextArea cols="50" rows="10" rendered="{!q.renderFreeText}"/>  
                      <apex:selectRadio rendered="{!q.renderSelectRow}">
                        <apex:selectOptions value="{!q.rowOptions}"/>
                      </apex:selectRadio>
                      

                      <!-- Matrix question -->
                      <apex:outputPanel rendered="{!q.childQuestions != null}" >
                        <table>
                          <tr>
                            <th class="matrixHeader">&nbsp;</th>
                            <apex:repeat value="{!q.matrixOptions}" var="vChoice" id="qHeaderMatrix">
                              <th class="matrixHeader">{! vChoice.label }</th>
                            </apex:repeat>
                          </tr>
                          
                          <!-- First question -->
                          <tr>
                            <th>{! q.subQuestion }</th>
                              <apex:repeat value="{!q.matrixOptions}" var="vChoice">
                                <td class="matrixChoice">
                                  <apex:outputPanel rendered="{! q.renderSingleMatrix == 'true' }">
                                    <input type="radio"/>
                                  </apex:outputPanel>
                                  <apex:outputPanel rendered="{! q.renderMultiMatrix == 'true' }">
                                    <input type="checkbox"/>
                                  </apex:outputPanel>
                                </td>
                              </apex:repeat>
                          </tr>
                          <apex:repeat value="{!q.childQuestions}" var="vSubQ" id="qSubRepeat">
                            <tr>
                              <th>{!vSubQ.subQuestion}</th>     
                              <apex:repeat value="{!vSubQ.matrixOptions}" var="vChoice">
                                <td class="matrixChoice">
                                  <apex:outputPanel rendered="{! q.renderSingleMatrix == 'true' }">
                                    <input type="radio"/>
                                  </apex:outputPanel>
                                  <apex:outputPanel rendered="{! q.renderMultiMatrix == 'true' }">
                                    <input type="checkbox"/>
                                  </apex:outputPanel>
                                </td>
                              </apex:repeat>                              
                            </tr>
                          </apex:repeat>
                        </table>
                      </apex:outputPanel>                     
                    </div>
                  </div>
                </div>  
              </apex:repeat>  
            </div>
          </apex:outputPanel> 
        </div>
      </apex:pageBlock>
    </apex:form>
  </div>
</apex:page>